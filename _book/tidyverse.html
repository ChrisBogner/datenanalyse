<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Kapitel 6 Tidyverse | Datenanalyse mit R</title>
<meta name="author" content="Christina Bogner">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7.4/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="font-awesome.min.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="SoSe 2021">Datenanalyse mit R</a>:
        <small class="text-muted">SoSe 2021</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Vorwort</a></li>
<li><a class="" href="einfuehrung.html"><span class="header-section-number">1</span> Der Kurs</a></li>
<li><a class="" href="erste-schritte.html"><span class="header-section-number">2</span> Erste Schritte in R</a></li>
<li><a class="" href="reproduzieren.html"><span class="header-section-number">3</span> Reproduzierbare Forschung</a></li>
<li><a class="" href="visualisieren.html"><span class="header-section-number">4</span> Daten visualisieren I: Einfache Grafiken</a></li>
<li><a class="" href="funktionen.html"><span class="header-section-number">5</span> Funktionen</a></li>
<li><a class="active" href="tidyverse.html"><span class="header-section-number">6</span> Tidyverse</a></li>
<li><a class="" href="aufgabensammlung.html"><span class="header-section-number">7</span> Aufgabensammlung</a></li>
<li><a class="" href="literatur.html">Literatur</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidyverse" class="section level1" number="6">
<h1>
<span class="header-section-number">Kapitel 6</span> Tidyverse<a class="anchor" aria-label="anchor" href="#tidyverse"><i class="fas fa-link"></i></a>
</h1>
<div class="rmdoutcomes">
<ul>
<li>
Kernpakete aus <code>tidyverse</code> benennen
</li>
<li>
ein einfaches Workflow (Daten einlesen, zusammenfassen, darstellen) mit <code>tidyverse</code> durchführen
</li>
<li>
Funktionen des Pakets <code>dplyr</code> für Datentransformation anwenden
</li>
</ul>
</div>
<p><code>tidyverse</code> ist eine Sammlung von R-Pakete, die explizit für Datenanalyse entwickelt wurden (<a href="https://www.tidyverse.org/" class="uri">https://www.tidyverse.org/</a>). <code>tidyverse</code> versucht durch gemeinsame Philosophie in Design, Grammatik und Datenstruktur die Datenanalyse zu erleichtern (<a href="https://design.tidyverse.org/" class="uri">https://design.tidyverse.org/</a>). Auch wenn <code>tidyverse</code> auf den ersten Blick etwas fremd erscheint, es ist ein Teil von R, kein eigenes Universum. Es ist also völlig in Ordnung, R-Basisfunktionen mit Funktionen aus <code>tidyverse</code> zu mischen.</p>
<p>Das wichtigste Einführungsbuch zu <code>tidyverse</code> ist sicherlich <strong>R4DS</strong>: “R for Data Science” <span class="citation">(<a href="literatur.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2021</a>)</span>, das Sie kostenlos online lesen können (<a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>).</p>
<div id="grundpakete" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Grundpakete<a class="anchor" aria-label="anchor" href="#grundpakete"><i class="fas fa-link"></i></a>
</h2>
<p><code>tidyverse</code> enthält folgende Grundpakete, die alle installiert werden, wenn Sie <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages('tidyverse')</a></code> eingeben.</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Paketname</th>
<th align="left">Kurzbeschreibung</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>ggplot2</code></td>
<td align="left">Visualisierung</td>
</tr>
<tr class="even">
<td align="left"><code>dplyr</code></td>
<td align="left">Datentransformation</td>
</tr>
<tr class="odd">
<td align="left"><code>tidyr</code></td>
<td align="left">Datenbereinigung</td>
</tr>
<tr class="even">
<td align="left"><code>readr</code></td>
<td align="left">Daten einlesen</td>
</tr>
<tr class="odd">
<td align="left"><code>purrr</code></td>
<td align="left">Funktionale Programmierung (Funktionen auf Objekte anwenden)</td>
</tr>
<tr class="even">
<td align="left"><code>tibble</code></td>
<td align="left">Erweiterung von <code>data.frame</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>stringr</code></td>
<td align="left">Funktionen für Strings, d.h. Textvariablen</td>
</tr>
<tr class="even">
<td align="left"><code>forcats</code></td>
<td align="left">Funktionen für <code>factor</code>
</td>
</tr>
</tbody>
</table></div>
<p>Jedes dieser Pakete hat ein Cheat Sheet, eine übersichtliche Zusammenstellung der Funktionen des Pakets. Sie bekommen die Cheet Sheats über die <code>tidyverse</code>-Seite (<a href="https://www.tidyverse.org/packages/" class="uri">https://www.tidyverse.org/packages/</a>), indem Sie auf das jeweilige Paket klicken und zum Abschnitt ‘Cheatsheet’ scrollen.</p>
</div>
<div id="der-workflow" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Der Workflow<a class="anchor" aria-label="anchor" href="#der-workflow"><i class="fas fa-link"></i></a>
</h2>
<div id="daten-einlesen" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> Daten einlesen<a class="anchor" aria-label="anchor" href="#daten-einlesen"><i class="fas fa-link"></i></a>
</h3>
<p>Sie kennen bereits die sehr umfangreiche Funktion <code><a href="https://rdrr.io/r/utils/read.table.html">read.table()</a></code> zum Einlesen der Daten. Die Funktion <code>read_delim()</code> ist die allgemeinste Funktion der <code>read_*</code> Familie aus <code>readr</code> in <code>tidyverse</code>; <code>read_csv()</code> und <code>read_csv2()</code> sind jeweils für komma- und strichpunkt-getrennte Datensätze gedacht. Man könnte berechtigterweise fragen, warum eine neue Funktion für etwas erfinden, was es schon gibt. Die Autoren von <code>tidyverse</code> versprechen Konsistenz und Geschwindigkeit. Ersteres war schon immer ein Problem von R, da es nicht von Computerspezialisten, sondern von Anwendern erfunden wurde. Daher ist eine Vereinheitlichung durch <code>tidyverse</code> mehr als willkommen. Und Geschwindigkeit ist spätestens bei größeren Datensätzen ein wichtiger Punkt.</p>
<p>Wir sehen uns erneut Daten des Deutschen Wetterdienstes an, wie im Kapitel <a href="visualisieren.html#visualisieren">4</a>. Nur diesmal sind es Stundenwerte für relative Luftfeuchte (%) und Lufttemperatur (°C). Die Daten von drei Wetterstationen, nämlich Hof, Frankfurt und Köln-Bonn, befinden sich in der Datei <span style="font-family: sans-serif; font-size: medium">Drei_Stationen.csv</span> Beim Einlesen zeigt Ihnen <code>read_delim()</code> bereits, welche Spalten und welche Datentypen es erkennt, mit <code>trim_ws = T</code> werden Leerzeichen aus Spalten entfernt.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">temp_humid</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="st">'Drei_Stationen.csv'</span>, delim <span class="op">=</span> <span class="st">';'</span>,
                         trim_ws <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   STATIONS_ID = col_double(),
##   MESS_DATUM = col_double(),
##   QN_9 = col_double(),
##   TT_TU = col_double(),
##   RF_TU = col_double(),
##   eor = col_character()
## )</code></pre>
<p>Eine weitere Kontrolle bietet die Funktion <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, die das eingelesene Ergebnis übersichtlich (und im Notebook interaktiv) darstellt. Sie müssen hier nicht mehr <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> verwenden, da grundsätzlich nur die ersten 10 Zeilen dargestellt werden.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 39,600 x 6
##    STATIONS_ID MESS_DATUM  QN_9 TT_TU RF_TU eor  
##          &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1        2261 2018111900     3  -2.8    99 eor  
##  2        2261 2018111901     3  -2.5   100 eor  
##  3        2261 2018111902     3  -2.3   100 eor  
##  4        2261 2018111903     3  -2     100 eor  
##  5        2261 2018111904     3  -1.9    99 eor  
##  6        2261 2018111905     3  -2.1    99 eor  
##  7        2261 2018111906     3  -1.8    99 eor  
##  8        2261 2018111907     3  -1.5    99 eor  
##  9        2261 2018111908     3  -1.1    99 eor  
## 10        2261 2018111909     3  -0.6    97 eor  
## # … with 39,590 more rows</code></pre>
<p>Das gleiche Ergebnis bekommen Sie auch ohne <code><a href="https://rdrr.io/r/base/print.html">print()</a></code>, wenn Sie wie gewohnt den Namen des Objekts tippen.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span></code></pre></div>
<pre><code>## # A tibble: 39,600 x 6
##    STATIONS_ID MESS_DATUM  QN_9 TT_TU RF_TU eor  
##          &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1        2261 2018111900     3  -2.8    99 eor  
##  2        2261 2018111901     3  -2.5   100 eor  
##  3        2261 2018111902     3  -2.3   100 eor  
##  4        2261 2018111903     3  -2     100 eor  
##  5        2261 2018111904     3  -1.9    99 eor  
##  6        2261 2018111905     3  -2.1    99 eor  
##  7        2261 2018111906     3  -1.8    99 eor  
##  8        2261 2018111907     3  -1.5    99 eor  
##  9        2261 2018111908     3  -1.1    99 eor  
## 10        2261 2018111909     3  -0.6    97 eor  
## # … with 39,590 more rows</code></pre>
<p>In diesem Datensatz sind folgende Parameter (Spalten) enthalten (s. Datensatzbeschreibung des DWDs)</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="left">Beschreibung</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">STATIONS_ID</td>
<td align="left">Stationsidentifikationsnummer</td>
</tr>
<tr class="even">
<td align="left">MESS_DATUM</td>
<td align="left">Zeitstempel im Format yyyymmddhh</td>
</tr>
<tr class="odd">
<td align="left">QN_9</td>
<td align="left">Qualitätsniveau der nachfolgenden Spalten</td>
</tr>
<tr class="even">
<td align="left">TT_TU</td>
<td align="left">Lufttemperatur in 2m Höhe °C</td>
</tr>
<tr class="odd">
<td align="left">RF_TU</td>
<td align="left">relative Feuchte %</td>
</tr>
<tr class="even">
<td align="left">eor</td>
<td align="left">Ende data record</td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "spec_tbl_df" "tbl_df"      "tbl"         "data.frame"</code></pre>
<p>Das Objekt <code>temp_humid</code> ist ein sogen. Tibble, ein <code>data.frame</code> mit “modernem” Verhalten. Z.B. gibt die Funktion <code><a href="https://rdrr.io/r/base/print.html">print()</a></code> nur die ersten 10 Zeilen aus, die Datentypen in den Spalten werden in hellgrau zwischen ‘&lt;&gt;’ mit angegeben etc. Mehr zu Tibbles finden Sie in Kapitel 10 “Tibbles” in R4DS.</p>
<p>Ein weiteres Paket, dass zwar nicht zum Kern von <code>tidyverse</code> gehört, jedoch trotzdem extrem nützlich ist, heißt <code>lubridate</code>. Es hilft, Text in richtige Datums-Objekte zu transformieren (ohne sich die kryptischen Datumsformate von R merken zu müssen). Wir transformieren die Spalte <code>temp_humid$MESS_DATUM</code> in ein richtiges Datum mit Uhrzeit.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'lubridate'</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     date, intersect, setdiff, union</code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span><span class="op">$</span><span class="va">MESS_DATUM</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_h</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">$</span><span class="va">MESS_DATUM</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 39,600 x 6
##    STATIONS_ID MESS_DATUM           QN_9 TT_TU RF_TU eor  
##          &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1        2261 2018-11-19 00:00:00     3  -2.8    99 eor  
##  2        2261 2018-11-19 01:00:00     3  -2.5   100 eor  
##  3        2261 2018-11-19 02:00:00     3  -2.3   100 eor  
##  4        2261 2018-11-19 03:00:00     3  -2     100 eor  
##  5        2261 2018-11-19 04:00:00     3  -1.9    99 eor  
##  6        2261 2018-11-19 05:00:00     3  -2.1    99 eor  
##  7        2261 2018-11-19 06:00:00     3  -1.8    99 eor  
##  8        2261 2018-11-19 07:00:00     3  -1.5    99 eor  
##  9        2261 2018-11-19 08:00:00     3  -1.1    99 eor  
## 10        2261 2018-11-19 09:00:00     3  -0.6    97 eor  
## # … with 39,590 more rows</code></pre>
</div>
<div id="daten-zusammenfassen" class="section level3" number="6.2.2">
<h3>
<span class="header-section-number">6.2.2</span> Daten zusammenfassen<a class="anchor" aria-label="anchor" href="#daten-zusammenfassen"><i class="fas fa-link"></i></a>
</h3>
<p>Die drei Wetterstationen haben folgende IDs:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">station_ids</span> <span class="op">&lt;-</span>  <span class="fu">tibble</span><span class="op">(</span><span class="st">'Hof'</span> <span class="op">=</span> <span class="st">'2261'</span>, <span class="st">'Frankfurt'</span> <span class="op">=</span> <span class="st">'1420'</span>, <span class="st">'Koeln'</span> <span class="op">=</span> <span class="st">'2667'</span><span class="op">)</span></code></pre></div>
<p>Ich möchte wissen, wie viele Messpunkte es pro Station gibt:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op">%&gt;%</span> 
  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1 39600</code></pre>
<p>Die Zeichenkombination <code>%&gt;%</code> heißt Pipe-Operator (<em>pipe</em>) und wird als ‘und dann’ gelesen (<em>then</em>). Der Ausdruck <code>temp_humid %&gt;% count()</code> heißt also: nimm <code>temp_humid</code> und dann zähle die Einträge. Der Pipe-Operator ist die Kernphilosophie von <code>tidyverse</code> und wird Ihnen überall begegnen. Der Operator stammt aus dem Paket <code>magrittr</code> (<a href="https://magrittr.tidyverse.org/" class="uri">https://magrittr.tidyverse.org/</a>). Seine Hauptaufgabe ist es, den Code übersichtlicher und besser lesbar zu machen (vielleicht nicht gleich zu Beginn der Lernkurve aber schon sehr bald 😄).</p>
<p>Die Funktion <code>count()</code> gehört zum Paket <code>dplyr</code>, das für Datentransformationen zuständig ist. Dieses Paket enthält 5 Grundfunktionen (alle nach Verben benannt 😄):</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Funktion</th>
<th align="left">Bedeutung</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code></td>
<td align="left">Wähle Daten anhand ihrere Werte</td>
</tr>
<tr class="even">
<td align="left"><code>arrange()</code></td>
<td align="left">Sortiere Zeilen</td>
</tr>
<tr class="odd">
<td align="left"><code>select()</code></td>
<td align="left">Wähle Variablen anhand ihrere Namen</td>
</tr>
<tr class="even">
<td align="left"><code>mutate()</code></td>
<td align="left">Erstelle neue Variablen als Funktionen vorhandener Variablen</td>
</tr>
<tr class="odd">
<td align="left"><code>summarize()</code></td>
<td align="left">Fasse Daten zusammen</td>
</tr>
</tbody>
</table></div>
<p>Ich möchte nun wissen, wie viele Messpunkte es für Köln-Bonn gibt. <code>tidyverse</code> ist konsistent: jeder Aufruf einer Funktion aus <code>dplyr</code> gibt ein <code>tiblle</code> zurück (und nicht mal <code>data.frame</code> mal Vektor).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">STATIONS_ID</span> <span class="op">==</span> <span class="va">station_ids</span><span class="op">$</span><span class="va">Koeln</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1 13200</code></pre>
</div>
<div id="daten-plotten" class="section level3" number="6.2.3">
<h3>
<span class="header-section-number">6.2.3</span> Daten plotten<a class="anchor" aria-label="anchor" href="#daten-plotten"><i class="fas fa-link"></i></a>
</h3>
<p>Wir wählen nur die Station Köln-Bonn und plotten die Stundenwerte der Temperatur mit dem Paket <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Köln-Bonn wählen</span>
<span class="va">koeln</span> <span class="op">&lt;-</span> <span class="va">temp_humid</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">STATIONS_ID</span> <span class="op">==</span> <span class="va">station_ids</span><span class="op">$</span><span class="va">Koeln</span><span class="op">)</span>

<span class="va">koeln</span></code></pre></div>
<pre><code>## # A tibble: 13,200 x 6
##    STATIONS_ID MESS_DATUM           QN_9 TT_TU RF_TU eor  
##          &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
##  1        2667 2018-11-19 00:00:00     3  -2.9    69 eor  
##  2        2667 2018-11-19 01:00:00     3  -1.7    78 eor  
##  3        2667 2018-11-19 02:00:00     3  -2.4    82 eor  
##  4        2667 2018-11-19 03:00:00     3   0.2    89 eor  
##  5        2667 2018-11-19 04:00:00     3   1.7    84 eor  
##  6        2667 2018-11-19 05:00:00     3   0.3    90 eor  
##  7        2667 2018-11-19 06:00:00     3   3.4    84 eor  
##  8        2667 2018-11-19 07:00:00     3   4.1    81 eor  
##  9        2667 2018-11-19 08:00:00     3   3.9    80 eor  
## 10        2667 2018-11-19 09:00:00     3   4.8    78 eor  
## # … with 13,190 more rows</code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plotten</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">koeln</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">MESS_DATUM</span>, y <span class="op">=</span> <span class="va">TT_TU</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="datenanalyse_files/figure-html/unnamed-chunk-46-1.png" width="672"></div>
<p>Sie werden sehr bald schon das Paket <code>ggplot2</code> nicht mehr missen wollen. Es erstellt mit wenig Aufwand sehr ansehnliche Grafiken. Natürlich müssen Sie, wie in Base-R auch, für professionelle Grafiken nacharbeiten.</p>
<p><code>ggplot2</code> folgt einer sogen. Grafikgrammatik (<em>grammer of graphics</em>), indem es seine Grafiken mit ‘+’ aufbaut. Erst sagt man in der Funktion <code>ggplot()</code> welchen Datensatz man plotten möchte, was auf die x- und y-Achse kommt und ob man z.B. Farbe für Gruppen in Daten möchte. All diese sichtbaren Elemente nennt man Ästhetiken (Parameter <code>aes</code>). Erst wenn diese ‘Formalien’ geklärt sind, sagt man, welche Form der Darstellung man möchte. Im oberen Beispiel ist es ein Linienplot. Alle Darstellungsarten in <code>ggplot2</code> beginnen mit <code>geom_*()</code> und sind daher konsistent benannt. Die Informationen zu Daten, x-, y-Achse etc. werden an die <code>geom_*()</code>-Funktionen von der Mutterfunktion <code>ggplot()</code> weiter vererbt. Daher sind die Klammern in <code>geom_line()</code> leer.</p>
<p>Wir wollen nun die Monatsmittelwerte für die Temperatur berechnen und diese darstellen. Als erstes erstellen wir zwei neue Spalten, die jeweils das Jahr und den Monat beinhalten. Die beiden neuen Spalten werden am Ende von <code>temp_humid</code> angehängt.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temp_humid</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="va">temp_humid</span>, 
                     year <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">$</span><span class="va">MESS_DATUM</span><span class="op">)</span>,
                     month <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">temp_humid</span><span class="op">$</span><span class="va">MESS_DATUM</span><span class="op">)</span><span class="op">)</span>

<span class="va">temp_humid</span></code></pre></div>
<pre><code>## # A tibble: 39,600 x 8
##    STATIONS_ID MESS_DATUM           QN_9 TT_TU RF_TU eor    year month
##          &lt;dbl&gt; &lt;dttm&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1        2261 2018-11-19 00:00:00     3  -2.8    99 eor    2018    11
##  2        2261 2018-11-19 01:00:00     3  -2.5   100 eor    2018    11
##  3        2261 2018-11-19 02:00:00     3  -2.3   100 eor    2018    11
##  4        2261 2018-11-19 03:00:00     3  -2     100 eor    2018    11
##  5        2261 2018-11-19 04:00:00     3  -1.9    99 eor    2018    11
##  6        2261 2018-11-19 05:00:00     3  -2.1    99 eor    2018    11
##  7        2261 2018-11-19 06:00:00     3  -1.8    99 eor    2018    11
##  8        2261 2018-11-19 07:00:00     3  -1.5    99 eor    2018    11
##  9        2261 2018-11-19 08:00:00     3  -1.1    99 eor    2018    11
## 10        2261 2018-11-19 09:00:00     3  -0.6    97 eor    2018    11
## # … with 39,590 more rows</code></pre>
<p>Jetzt können wir einen neuen Datensatz mit den Mittelwerten erstellen. Dafür gruppieren wir erst einmal die Daten nach <code>STATIONS_ID</code>, <code>year</code> und <code>month</code>. Die Mittelwerte sollen ja je Station, Jahr und Monat berechnet werden.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">by_month</span> <span class="op">&lt;-</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">temp_humid</span>, <span class="va">STATIONS_ID</span>, <span class="va">year</span>, <span class="va">month</span><span class="op">)</span>
<span class="va">monthly_means</span> <span class="op">&lt;-</span> <span class="fu">summarize</span><span class="op">(</span><span class="va">by_month</span>, mean_T <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">TT_TU</span><span class="op">)</span>, mean_RH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">RF_TU</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by 'STATIONS_ID', 'year' (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_means</span></code></pre></div>
<pre><code>## # A tibble: 57 x 5
## # Groups:   STATIONS_ID, year [9]
##    STATIONS_ID  year month mean_T mean_RH
##          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1        1420  2018    11   4.00    79.7
##  2        1420  2018    12   4.73    83.7
##  3        1420  2019     1   2.12    79.3
##  4        1420  2019     2   4.48    74.1
##  5        1420  2019     3   8.28    68.5
##  6        1420  2019     4  11.7     61.0
##  7        1420  2019     5  12.7     67.5
##  8        1420  2019     6  21.4     60.6
##  9        1420  2019     7  21.6     55.6
## 10        1420  2019     8  20.7     65.6
## # … with 47 more rows</code></pre>
<p>Die Struktur von <code>monthly_means</code> zeigt uns, dass es sich um gruppierte Daten handelt.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">monthly_means</span><span class="op">)</span></code></pre></div>
<pre><code>## tibble [57 × 5] (S3: grouped_df/tbl_df/tbl/data.frame)
##  $ STATIONS_ID: num [1:57] 1420 1420 1420 1420 1420 1420 1420 1420 1420 1420 ...
##  $ year       : num [1:57] 2018 2018 2019 2019 2019 ...
##  $ month      : num [1:57] 11 12 1 2 3 4 5 6 7 8 ...
##  $ mean_T     : num [1:57] 4 4.73 2.12 4.48 8.28 ...
##  $ mean_RH    : num [1:57] 79.7 83.7 79.3 74.1 68.5 ...
##  - attr(*, "groups")= tibble [9 × 3] (S3: tbl_df/tbl/data.frame)
##   ..$ STATIONS_ID: num [1:9] 1420 1420 1420 2261 2261 ...
##   ..$ year       : num [1:9] 2018 2019 2020 2018 2019 ...
##   ..$ .rows      : list&lt;int&gt; [1:9] 
##   .. ..$ : int [1:2] 1 2
##   .. ..$ : int [1:12] 3 4 5 6 7 8 9 10 11 12 ...
##   .. ..$ : int [1:5] 15 16 17 18 19
##   .. ..$ : int [1:2] 20 21
##   .. ..$ : int [1:12] 22 23 24 25 26 27 28 29 30 31 ...
##   .. ..$ : int [1:5] 34 35 36 37 38
##   .. ..$ : int [1:2] 39 40
##   .. ..$ : int [1:12] 41 42 43 44 45 46 47 48 49 50 ...
##   .. ..$ : int [1:5] 53 54 55 56 57
##   .. ..@ ptype: int(0) 
##   ..- attr(*, ".drop")= logi TRUE</code></pre>
<p>Da wir aber mit den Daten weiter rechnen wollen, ist es besser, die Gruppierung wieder aufzugeben. Es könnte sonst später Fehlermeldungen geben.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_means</span> <span class="op">&lt;-</span> <span class="fu">ungroup</span><span class="op">(</span><span class="va">monthly_means</span><span class="op">)</span></code></pre></div>
<p>Um die Daten als Zeitreihen zu plotten, erstellen wir noch eine ordentliche Zeit-Spalte. Die Funktion <code><a href="http://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time()</a></code> kann aus Character richtige Datums-Zeitobjekte erstellen. Sie ist allgemeienr als die oben verwendete <code><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd()</a></code> Funktion, da man hier das Format explizit angeben kann. In unserem Fall ist das Format ‘ym’ für Jahr und Monat.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthly_means</span> <span class="op">&lt;-</span> <span class="va">monthly_means</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>my_date <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/parse_date_time.html">parse_date_time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">monthly_means</span><span class="op">$</span><span class="va">year</span>,
                  <span class="va">monthly_means</span><span class="op">$</span><span class="va">month</span><span class="op">)</span>, <span class="st">'ym'</span>, tz <span class="op">=</span> <span class="st">'CET'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">monthly_means</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">my_date</span>, y <span class="op">=</span> <span class="va">mean_T</span>, 
            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">STATIONS_ID</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time'</span>, y <span class="op">=</span> <span class="st">'Temperature (°C)'</span>, color <span class="op">=</span> <span class="st">'Station'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="datenanalyse_files/figure-html/unnamed-chunk-52-1.png" width="672"></div>
<p>Wir werden in eine spätere Kapitel auf <code>ggplot2</code> genauer eingehen. Fürs Erste soll es als Appetithappen reichen 🍰.</p>
</div>
</div>
<div id="weiterführende-literatur-und-videos" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Weiterführende Literatur und Videos<a class="anchor" aria-label="anchor" href="#weiterf%C3%BChrende-literatur-und-videos"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>R4DS: Kapitel 5 “Data transformation,” 11 “Data import”</p></li>
<li><p>Eine live Analyse des Hauptautors von <code>tidyverse</code>, Hadley Wickham. Empfehlenswert, auch wenn er viel zu schnell tippt 😄.</p></li>
</ul>
<iframe width="913" height="432" src="https://www.youtube.com/embed/go5Au01Jrvs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
</iframe>
</div>
<div id="inhalt-der-live-einführung-3" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Inhalt der live Einführung<a class="anchor" aria-label="anchor" href="#inhalt-der-live-einf%C3%BChrung-3"><i class="fas fa-link"></i></a>
</h2>
<p>Verschiedene Funktionen aus <code>tydiverse</code> anhand der Aufgaben <a href="aufgabensammlung.html#fledermaus3">7.6.1</a> und <a href="aufgabensammlung.html#klausur">7.6.2</a></p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="funktionen.html"><span class="header-section-number">5</span> Funktionen</a></div>
<div class="next"><a href="aufgabensammlung.html"><span class="header-section-number">7</span> Aufgabensammlung</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidyverse"><span class="header-section-number">6</span> Tidyverse</a></li>
<li><a class="nav-link" href="#grundpakete"><span class="header-section-number">6.1</span> Grundpakete</a></li>
<li>
<a class="nav-link" href="#der-workflow"><span class="header-section-number">6.2</span> Der Workflow</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#daten-einlesen"><span class="header-section-number">6.2.1</span> Daten einlesen</a></li>
<li><a class="nav-link" href="#daten-zusammenfassen"><span class="header-section-number">6.2.2</span> Daten zusammenfassen</a></li>
<li><a class="nav-link" href="#daten-plotten"><span class="header-section-number">6.2.3</span> Daten plotten</a></li>
</ul>
</li>
<li><a class="nav-link" href="#weiterf%C3%BChrende-literatur-und-videos"><span class="header-section-number">6.3</span> Weiterführende Literatur und Videos</a></li>
<li><a class="nav-link" href="#inhalt-der-live-einf%C3%BChrung-3"><span class="header-section-number">6.4</span> Inhalt der live Einführung</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Datenanalyse mit R</strong>: SoSe 2021" was written by Christina Bogner. It was last built on 2021-04-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
